<div class="d-flex flex-column-fluid">
    <div hidden id="courseID">{{course._id}}</div>    
    <div hidden id="rate">{{myRate}}</div>
    <!--begin::Container-->
    <div class="container-fluid">
        <!--begin::Card-->
      
        <div class="card card-custom gutter-b">
            <div class="card-body">
                <div class="d-flex">
                    <!--begin: Pic-->
                    <div class="flex-shrink-0 mr-7 mt-lg-0 mt-3">
                        <div class="symbol symbol-50 symbol-lg-120">
                            <img alt="Pic" src="{{course.thumbnail}}">
                        </div>
                        <div class="symbol symbol-50 symbol-lg-120 symbol-primary d-none">
                            <span class="font-size-h3 symbol-label font-weight-boldest">JM</span>
                        </div>
                    </div>
                    <!--end: Pic-->
                    <!--begin: Info-->
                    <div class="flex-grow-1">
                        <!--begin: Title-->
                        <div class="d-flex align-items-center justify-content-between flex-wrap">
                            <div class="mr-3">
                                <!--begin::Name-->
                                <a href="#" class="d-flex align-items-center text-dark text-hover-primary font-size-h5 font-weight-bold mr-3">{{course.name}}
                                <i class="flaticon2-correct text-success icon-md ml-2"></i></a>
                                <!--end::Name-->
                                <!--begin::Contacts-->
                                <div class="d-flex flex-wrap my-2">
                                    <a href="/user/profile/{{author._id}}" class="text-muted text-hover-primary font-weight-bold mr-3">
                                    <span class="svg-icon svg-icon-md svg-icon-gray-500 mr-1"><!--begin::Svg Icon | path:C:\wamp64\www\keenthemes\themes\metronic\theme\html\demo2\dist/../src/media/svg/icons\General\User.svg--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                            <polygon points="0 0 24 0 24 24 0 24"/>
                                            <path d="M12,11 C9.790861,11 8,9.209139 8,7 C8,4.790861 9.790861,3 12,3 C14.209139,3 16,4.790861 16,7 C16,9.209139 14.209139,11 12,11 Z" fill="#000000" fill-rule="nonzero" opacity="0.3"/>
                                            <path d="M3.00065168,20.1992055 C3.38825852,15.4265159 7.26191235,13 11.9833413,13 C16.7712164,13 20.7048837,15.2931929 20.9979143,20.2 C21.0095879,20.3954741 20.9979143,21 20.2466999,21 C16.541124,21 11.0347247,21 3.72750223,21 C3.47671215,21 2.97953825,20.45918 3.00065168,20.1992055 Z" fill="#000000" fill-rule="nonzero"/>
                                        </g>
                                    </svg><!--end::Svg Icon--></span>
                                    </span> {{author.fullname}}</a>  
                                    <a href="#" class="text-muted text-hover-primary font-weight-bold mr-lg-8 mr-5 mb-lg-0 mb-2">
                                    <span class="svg-icon svg-icon-md svg-icon-gray-500 mr-1">
                                        <!--begin::Svg Icon | path:assets/media/svg/icons/Communication/Mail-notification.svg-->
                                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                <rect x="0" y="0" width="24" height="24"></rect>
                                                <path d="M21,12.0829584 C20.6747915,12.0283988 20.3407122,12 20,12 C16.6862915,12 14,14.6862915 14,18 C14,18.3407122 14.0283988,18.6747915 14.0829584,19 L5,19 C3.8954305,19 3,18.1045695 3,17 L3,8 C3,6.8954305 3.8954305,6 5,6 L19,6 C20.1045695,6 21,6.8954305 21,8 L21,12.0829584 Z M18.1444251,7.83964668 L12,11.1481833 L5.85557487,7.83964668 C5.4908718,7.6432681 5.03602525,7.77972206 4.83964668,8.14442513 C4.6432681,8.5091282 4.77972206,8.96397475 5.14442513,9.16035332 L11.6444251,12.6603533 C11.8664074,12.7798822 12.1335926,12.7798822 12.3555749,12.6603533 L18.8555749,9.16035332 C19.2202779,8.96397475 19.3567319,8.5091282 19.1603533,8.14442513 C18.9639747,7.77972206 18.5091282,7.6432681 18.1444251,7.83964668 Z" fill="#000000"></path>
                                                <circle fill="#000000" opacity="0.3" cx="19.5" cy="17.5" r="2.5"></circle>
                                            </g>
                                        </svg>
                                        <!--end::Svg Icon-->
                                    </span>{{author.email}}</a>
                                    <a href="#" class="text-muted text-hover-primary font-weight-bold mr-lg-8 mr-5 mb-lg-0 mb-2">
                                    <span class="svg-icon svg-icon-md svg-icon-gray-500 mr-1">
                                        <!--begin::Svg Icon | path:assets/media/svg/icons/General/Lock.svg-->
                                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                <mask fill="white">
                                                    <use xlink:href="#path-1"></use>
                                                </mask>
                                                <g></g>
                                                <path d="M7,10 L7,8 C7,5.23857625 9.23857625,3 12,3 C14.7614237,3 17,5.23857625 17,8 L17,10 L18,10 C19.1045695,10 20,10.8954305 20,12 L20,18 C20,19.1045695 19.1045695,20 18,20 L6,20 C4.8954305,20 4,19.1045695 4,18 L4,12 C4,10.8954305 4.8954305,10 6,10 L7,10 Z M12,5 C10.3431458,5 9,6.34314575 9,8 L9,10 L15,10 L15,8 C15,6.34314575 13.6568542,5 12,5 Z" fill="#000000"></path>
                                            </g>
                                        </svg>
                                        <!--end::Svg Icon-->
                                    </span>PR </a>
                                    
                                </div>
                                <!--end::Contacts-->
                            </div>
                            <div class="my-lg-0 my-1">
                                <a name="enroll" class="btn btn-sm btn-light-info font-weight-bolder text-uppercase mr-3">Mua khóa học</a>
                                {{#if favorite}}    
                                <i id="watchlist" class="icon-xl text-danger fas fa-heart"></i>
                                {{else}}
                                <i id="watchlist" class="icon-xl text-danger far fa-heart"></i>
                                {{/if}}
                            </div>
                        </div>
                        <!--end: Title-->
                        <!--begin: Content-->
                        <div class="d-flex flex-column flex-wrap justify-content-between">
                            <div class="flex-grow-1 font-weight-bold text-dark-50 py-5 py-lg-2 mr-5">
                                {{course.overview}}
                            </div>
                            <div class="d-flex flex-wrap align-items-center py-2">
                                <div class="d-flex align-items-center mr-10">
                                    <div class="mr-6">
                                        <div class="font-weight-bold mb-2">Ngày đăng tải</div>
                                        <span class="btn btn-sm btn-text btn-light-primary text-uppercase font-weight-bold">{{createdAt}}</span>
                                    </div>
                                    <div class="mr-6">
                                        <div class="font-weight-bold mb-2">Lần cập nhật cuối</div>
                                        <span class="btn btn-sm btn-text btn-light-danger text-uppercase font-weight-bold">{{updatedAt}}</span>
                                    </div>
                                    <div class="mr-6">
                                        <div class="font-weight-bold mb-2">Chủ Đề</div>
                                        <span class="btn btn-sm btn-text btn-light-success text-uppercase font-weight-bold">{{SubCategory}}</span>
                                    </div>
                                </div>
                                
                                <form action="">
                                    <div class="flex-grow-1 flex-shrink-0 mr-5 mt-4 mt-sm-0">
                                        <div class="font-weight-bold mb-2">Đánh giá</div>
                                        <fieldset class="rating">
                                        <input type="radio" id="star5" name="rating" value="5" />
                                        <label for="star5">5 stars</label>
                                        <input type="radio" id="star4" name="rating" value="4" />
                                        <label for="star4">4 stars</label>
                                        <input type="radio" id="star3" name="rating" value="3" />
                                        <label for="star3">3 stars</label>
                                        <input type="radio" id="star2" name="rating" value="2" />
                                        <label for="star2">2 stars</label>
                                        <input type="radio" id="star1" name="rating" value="1" />
                                        <label for="star1">1 star</label>
                                        </fieldset>
                                    <div id="choice"></div>
                                </div>
                                </form>
                                 <a tabindex="0" class="btn btn-outline-success" id="feedback" role="button"data-trigger="click" data-toggle="popover" title="Viết nhận xét" data-html="true" data-content="">  Thêm nhận xét
                                    </a>
                                    <div hidden id="content" class="hide">
                                        <form method="POST" action="/student/feedback" class="my-0 py-0"> 
                                            <textarea name="review" type="text" style="font-size: 1.9rem" class="md-textarea form-control py-0" placeholder="Đánh giá khóa học" rows="5"></textarea> 
                                            <input hidden type="text" name="courseID" value="{{course._id}}">
                                            <button id="voteSubmitButton" type="submit" class="btn btn-sm btn-primary">Gửi nhận xét</button>  
                                        </form>
                                    </div>
                                
                            </div>
                        </div>
                        <!--end: Content-->
                    </div>
                    <!--end: Info-->
                </div>
                <div class="separator separator-solid my-7"></div>
                <!--begin: Items-->
                <div class="d-flex align-items-center flex-wrap">
                    <!--begin: Item-->
                    <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="flaticon-piggy-bank icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column text-dark-75">
                            <span class="font-weight-bolder font-size-sm">Giá gốc</span>
                            <span class="font-weight-bolder font-size-h5">
                            <span class="text-dark-50 font-weight-bold">$</span><s>{{course.price}}</s></span>
                        </div>
                    </div>
                    <!--end: Item-->
                    <!--begin: Item-->
                    <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="flaticon-confetti icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column text-dark-75">
                            <span class="font-weight-bolder font-size-sm">Gía khuyến mãi</span>
                            <span class="font-weight-bolder font-size-h5">
                            <span class="text-dark-50 font-weight-bold">$</span>{{course.price_discount}}</span>
                        </div>
                    </div>
                    <!--end: Item-->
                    <!--begin: Item-->
                    <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="flaticon-pie-chart icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column text-dark-75">
                            <span class="font-weight-bolder font-size-sm">Net</span>
                            <span class="font-weight-bolder font-size-h5">
                            <span class="text-dark-50 font-weight-bold">$</span>782,300</span>
                        </div>
                    </div>
                    <!--end: Item-->
                    <!--begin: Item-->
                    <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="flaticon-file-2 icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column flex-lg-fill">
                            <span class="text-dark-75 font-weight-bolder font-size-sm">{{chapters.length}} chương</span>
                            <a href="#" class="text-primary font-weight-bolder">Xem</a>
                        </div>
                    </div>
                    <!--end: Item-->
                    <!--begin: Item-->
                    <div class="d-flex align-items-center flex-lg-fill mr-5 my-1">
                        <span class="mr-4">
                            <i class="flaticon-chat-1 icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="d-flex flex-column">
                            <span class="text-dark-75 font-weight-bolder font-size-sm">{{nRate}} Đánh giá</span>
                            <a href="#" class="text-primary font-weight-bolder">Xem</a>
                        </div>
                    </div>
                    <!--end: Item-->
                    <!--begin: Item-->
                    <div class="d-flex align-items-center flex-lg-fill my-1">
                        <span class="mr-4">
                            <i class="flaticon-network icon-2x text-muted font-weight-bold"></i>
                        </span>
                        <div class="symbol-group symbol-hover">
                            <div class="symbol symbol-30 symbol-circle" data-toggle="tooltip" title="" data-original-title="Mark Stone">
                                <img alt="Pic" src="/assets/media/users/300_25.jpg">
                            </div>
                            <div class="symbol symbol-30 symbol-circle" data-toggle="tooltip" title="" data-original-title="Charlie Stone">
                                <img alt="Pic" src="/assets/media/users/300_19.jpg">
                            </div>
                            <div class="symbol symbol-30 symbol-circle" data-toggle="tooltip" title="" data-original-title="Luca Doncic">
                                <img alt="Pic" src="/assets/media/users/300_22.jpg">
                            </div>
                            <div class="symbol symbol-30 symbol-circle" data-toggle="tooltip" title="" data-original-title="Nick Mana">
                                <img alt="Pic" src="/assets/media/users/300_23.jpg">
                            </div>
                            <div class="symbol symbol-30 symbol-circle" data-toggle="tooltip" title="" data-original-title="Teresa Fox">
                                <img alt="Pic" src="/assets/media/users/300_18.jpg">
                            </div>
                            <div class="symbol symbol-30 symbol-circle symbol-light">
                                <span class="symbol-label font-weight-bold">5+</span>
                            </div>
                        </div>
                    </div>
                    <!--end: Item-->
                </div>
                <!--begin: Items-->
            </div>
        </div>


        
        <!--end::Card-->
        <div class="card-body flex-grow-1">
            <!--begin::Row-->
           <div class="row"  >
                <div class="col-lg-3 col-xl-4">
                    <div class="card card-custom gutter-b example example-compact">
                        <div class="card-header" style ="background: linear-gradient(to right, #74ebd5, #acb6e5); ">
                            <div class="card-title" style="font-size:x-large; ">
                                Đề cương khóa học
                            </div>
                            <small class="card-title">{{chapters.length}} chương - {{numLesson}} bài học</small>
                            
                        </div>
                        <div class="card-body">
                            <div class="accordion accordion-light accordion-light-borderless accordion-svg-toggle" id="">
    {{#each chapters}}
    <!--begin::Card-->
                                <div class="card border-top-3 pd-12 ">
                                    <div class="card-header telegram settings"  id="h{{_id}}">
                                        <div class="mask">
                                        <div class="card-title text-dark collapsed " data-toggle="collapse" data-target="#i{{_id}}" aria-expanded="false" aria-controls="i{{_id}}" role="button">
                                            <span class="svg-icon svg-icon-primary">
                                                <!--begin::Svg Icon | path:assets/media/svg/icons/Navigation/Angle-double-right.svg-->
                                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                        <polygon points="0 0 24 0 24 24 0 24"></polygon>
                                                        <path d="M12.2928955,6.70710318 C11.9023712,6.31657888 11.9023712,5.68341391 12.2928955,5.29288961 C12.6834198,4.90236532 13.3165848,4.90236532 13.7071091,5.29288961 L19.7071091,11.2928896 C20.085688,11.6714686 20.0989336,12.281055 19.7371564,12.675721 L14.2371564,18.675721 C13.863964,19.08284 13.2313966,19.1103429 12.8242777,18.7371505 C12.4171587,18.3639581 12.3896557,17.7313908 12.7628481,17.3242718 L17.6158645,12.0300721 L12.2928955,6.70710318 Z" fill="#000000" fill-rule="nonzero"></path>
                                                        <path d="M3.70710678,15.7071068 C3.31658249,16.0976311 2.68341751,16.0976311 2.29289322,15.7071068 C1.90236893,15.3165825 1.90236893,14.6834175 2.29289322,14.2928932 L8.29289322,8.29289322 C8.67147216,7.91431428 9.28105859,7.90106866 9.67572463,8.26284586 L15.6757246,13.7628459 C16.0828436,14.1360383 16.1103465,14.7686056 15.7371541,15.1757246 C15.3639617,15.5828436 14.7313944,15.6103465 14.3242754,15.2371541 L9.03007575,10.3841378 L3.70710678,15.7071068 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" transform="translate(9.000003, 11.999999) rotate(-270.000000) translate(-9.000003, -11.999999)"></path>
                                                    </g>
                                                </svg>
                                                <!--end::Svg Icon-->
                                            </span> 
                                            <div class="card-label font-weight-bolder text-dark pl-4">{{name}} <span class = "float-right mr-4 text-dark-75" >{{lessons.length}} Bài học</span></div>
                                        </div>
                                        </div>
                                    </div>
                                    <div id="i{{_id}}" class="collapse" aria-labelledby="h{{_id}}" data-parent="" style="">
                                
                                        <div class="table-responsive">
                                            <table class="table table-borderless table-vertical-center">
                                                
                                                <tbody>
                                                    {{#each lessons}}
                                                    <tr class="settings2">
                                                        <td class="pl-10 pt-0 py-5 ">
                                                            <i class="fa fas fa-photo-video text-warning icon-xl"></i>
                                                        </td>
                                                        <td class="pl-0">
                                                            <a  class="text-dark-75 font-weight-bolder text-hover-primary mb-1 font-size-lg" href="{{_id}}">{{name}}</a>
                                                            <span class="progress">
                                                                <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger" role="progressbar" style="width: {{prog}}%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                                            </span>
                                                        </td>
                                                        <!--Video Modal -->
                                                        <div hidden class="modal fade center" role="dialog" >
                                                            <div class="modal-dialog modal-lg">
                                                            <!-- Modal content-->
                                                            <div class="modal-content">
                                                                <div class="modal-body">
                                                                <video id="i{{_id}}" class="video-js"onpause="pauseFunction('i{{_id}}')" controls preload="video-js vjs-default-skin vjs-big-play-centered" width="640" height="264" poster="" data-setup='{}'>
                                                                    <source src="/video/{{video}}" type='video/mp4'>
                                                                </video>
                                                                </div>  
                                                            </div>
                                                            </div>
                                                        </div>
                                                        <!--Video Modal -->
             
                                                        <td></td>
                                                        <td class="text-left">
                                                            <span class="text-dark-75 font-weight-bolder d-block font-size-lg">Thời lượng</span>
                                                            <span class="text-muted font-weight-bold d-block font-size-sm i{{_id}}">Time</span>
                                                        </td>
                                                    
                                                    </tr>
                                                    {{/each}}
                                                </tbody>
                            <!--end::Tbody-->
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                             {{/each}}
    <!--end::Card-->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-xl-7">
                    <div class="card card-custom gutter-b example example-compact">
                        <div class="card-header" style ="background: linear-gradient(to right, #74ebd5, #acb6e5); ">
                            <div class="card-title" style="font-size:x-large; ">
                                Bài học
                            </div>
                            
                        </div>
                        <div class="videoWrapper">
                        <video id="id{{lesson._id}}" class="video-js myVideo" onpause="pauseFunction('id{{lesson._id}}')" controls preload="video-js vjs-default-skin vjs-big-play-centered" poster="{{course.thumbnail}}">
                            <source src="/video/{{lesson.video}}" type='video/mp4'>
                        </video>
                        </div>
                        
                    </div>
                </div>
            <!--end::Row-->
            </div>
        </div>
    </div>
</div>

<script>

    function pauseFunction(id){
        player = document.getElementById(id);

        var percentComplete = player.currentTime/player.duration*100;
        $.post("/student/update-progress", {progress: percentComplete, lessonID: id.substring(2)}, function(result){
            
       // $("span").html(result);
  });
    }
    $('#voteSubmitButton').click(function(){
        $('#feedback').click()
        review = $('textarea').value
        id = $('#courseID').html()
        alert(review)
        $.post("/student/feedback", {review: review, courseID: id}, function(result){     
       // $("span").html(result);
  });
    })

var T = setInterval(function(){
    var video =$( "video" );

    for(x of video)
    {
        var id = (x.id.substring(0,x.id.indexOf('_')));
        //player = document.getElementById(id);
        $("."+id).html(new Date(x.duration * 1000).toISOString().substr(11, 8))
        //alert(video[0].attr('id'))
    }
    if (video.every(x=> x.duration != undefined)) clearInterval(T)
}, 1000);

$('.rating input').change(
  function() {

    $('#choice').text(this.value + ' stars');
    id = $('#courseID').html()
    $.post("/student/rate", {rate: this.value, courseID: id}, function(result){
            
       // $("span").html(result);
  });
  }
)
$('#watchlist').click(function(){
    id = $('#courseID').html()
    if( $(this).hasClass("far"))
    {
        $(this).attr("class", "icon-xl text-danger fas fa-heart")
        $.post("/student/favorite", {favorite: true, courseID: id})
    }
    else 
    {
        $(this).attr("class", "icon-xl text-danger far fa-heart")
        $.post("/student/favorite", {favorite: false, courseID: id})
    }
})

$(document).ready(function(){
    //fas fa-star-half-alt
    rate = $('#rate').html()
    $('#star'+rate.substring(0,1)).prop("checked", true);
    $('#feedback').attr("data-content", $('#content').html())
    $('[data-toggle="popover"]').popover();   
});
</script>

